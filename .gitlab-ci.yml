include:
    - component: gitlab.primary/cicd/components/containers/docker@0.5.0-1
#
#variables:
#    DOCKER_BUILDKIT: "1"
#    BUILDKIT_PROGRESS: "plain"
#
#include:
#    - component: gitlab.primary/cicd/components/containers/docker@0.5.0-1
#      inputs:
#          project_manifest: Dockerfile

#"üê¢ deploy":
#    stage: üöÄ Deploy
#    image: $CI_REGISTRY_BASE_URL/bash:5.2.26
#    variables:
#        SERVICE_NAME: "one-clearing.jiratrackerfront"
#        ENV_NAME: "Development"
#        ENV_URL: "https://track.oneclearing.dev.primary/"
#        ENV_HOST: "oneclearing.dev.primary"
#    tags:
#        - clearing-tech
#    before_script:
#        - 'command -v ssh-agent >/dev/null || ( apk add --no-cache openssh-client-common openssh-client-default )'
#        - eval $(ssh-agent -s)
#        - ssh-add <(cat "${CD_KEY}" | base64 -d)
#        - mkdir -p ~/.ssh
#        - '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'
#    script:
#        - |
#            echo "üöÄ Deploying component $SERVICE_NAME $ARTIFACT_VERSION_FULL to DEV..."
#            ssh ${CD_USER}@${ENV_HOST} " \
#                pushd /opt/one-clearing \
#             && sed -i -r \"s/^(${SERVICE_VERSION_VAR})=.*/\1=${ARTIFACT_VERSION_FULL}/g\" .env \
#             && docker compose up --pull=always --detach --force-recreate ${SERVICE_NAME} \
#             && docker image prune --all --force"
#            echo "üöÄ Deploying component $SERVICE_NAME $ARTIFACT_VERSION_FULL to DEV... Done!"
#    environment:
#        name: ${ENV_NAME}
#        url: ${ENV_URL}        
#    needs:
#        - job: "üêã docker_build"
#    rules:
#        - if: $CI_COMMIT_TAG == $CI_PIPELINE_SOURCE != "merge_request_event"
#          when: on_success